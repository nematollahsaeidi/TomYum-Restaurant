<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üçú Tom Yum Thai - Robot Control Panel</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Leaflet (Map) -->
    <link href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" rel="stylesheet">
    <style>
        #map { height: 400px; }
        .robot-status { 
            transition: all 0.3s ease;
        }
        .robot-moving { 
            background-color: #e8f5e9 !important;
            border-left: 4px solid #4caf50 !important;
        }
        .robot-charging { 
            background-color: #fff3e0 !important;
            border-left: 4px solid #ff9800 !important;
        }
        .robot-idle { 
            background-color: #f5f5f5 !important;
            border-left: 4px solid #9e9e9e !important;
        }
        .priority-high { color: #d32f2f; font-weight: bold; }
        .priority-medium { color: #f57c00; }
        .priority-low { color: #388e3c; }
        .task-running { border-left: 4px solid #1976d2; }
        .task-ready { border-left: 4px solid #4caf50; }
        .task-waiting { border-left: 4px solid #ff9800; }
        .nav-link.active {
            background-color: #0d6efd !important;
            color: white !important;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <!-- Header -->
        <div class="row bg-primary text-white p-3 mb-3">
            <div class="col-12 d-flex justify-content-between align-items-center">
                <h1><i class="bi bi-robot me-2"></i>üçú Tom Yum Thai - Robot Control Panel</h1>
                <button class="btn btn-light" id="logoutBtn">
                    <i class="bi bi-box-arrow-right me-1"></i>Logout
                </button>
            </div>
        </div>

        <!-- Navigation -->
        <div class="row mb-4">
            <div class="col-12">
                <ul class="nav nav-tabs">
                    <li class="nav-item">
                        <a class="nav-link active" href="#/"><i class="bi bi-speedometer2 me-1"></i>Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#/queue"><i class="bi bi-list-task me-1"></i>Queue</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#/reports"><i class="bi bi-bar-chart me-1"></i>Reports</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#/analytics"><i class="bi bi-graph-up me-1"></i>Analytics</a>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h5 class="card-title">Active Tasks</h5>
                        <h2 class="text-primary" id="activeTasksCount">5</h2>
                        <p class="text-muted">2 in progress</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h5 class="card-title">Robots Status</h5>
                        <h2 class="text-success" id="robotsOkCount">4</h2>
                        <p class="text-muted">All operational</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h5 class="card-title">Battery Level</h5>
                        <h2 class="text-warning" id="avgBatteryLevel">71%</h2>
                        <p class="text-muted">Average across fleet</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h5 class="card-title">System Health</h5>
                        <h2 class="text-info" id="systemHealth">98%</h2>
                        <p class="text-muted">All systems nominal</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="row">
            <!-- Map Section -->
            <div class="col-md-8">
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="bi bi-map me-2"></i>Restaurant Map (Interactive)</h5>
                        <div>
                            <span class="badge bg-danger me-2"><i class="bi bi-geo-alt-fill"></i> Order Points</span>
                            <span class="badge bg-success me-2"><i class="bi bi-cash"></i> Billing Points</span>
                            <span class="badge bg-primary me-2"><i class="bi bi-box-seam"></i> Delivery</span>
                            <span class="badge bg-purple me-2"><i class="bi bi-trash"></i> Collection</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="map"></div>
                        <div class="mt-3">
                            <h6>Table Controls:</h6>
                            <div class="btn-group flex-wrap" role="group">
                                <button type="button" class="btn btn-outline-primary">T1</button>
                                <button type="button" class="btn btn-outline-primary">T2</button>
                                <button type="button" class="btn btn-outline-primary">T3</button>
                                <button type="button" class="btn btn-outline-primary">T4</button>
                                <button type="button" class="btn btn-outline-primary">T5</button>
                                <button type="button" class="btn btn-outline-primary">T6</button>
                                <button type="button" class="btn btn-outline-primary">T7</button>
                                <button type="button" class="btn btn-outline-primary">T8</button>
                            </div>
                        </div>
                        <div class="mt-3">
                            <h6>Actions:</h6>
                            <button class="btn btn-success me-2">
                                <i class="bi bi-box-seam me-1"></i>Deliver Food
                            </button>
                            <button class="btn btn-warning">
                                <i class="bi bi-trash me-1"></i>Collect Dishes
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Sidebar -->
            <div class="col-md-4">
                <!-- Active Tasks Queue -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-list-task me-2"></i>Active Tasks Queue</h5>
                    </div>
                    <div class="card-body">
                        <div class="list-group">
                            <div class="list-group-item task-running" data-id="T-101">
                                <div class="d-flex justify-content-between">
                                    <h6 class="mb-1">T-101: Deliver to Table 5</h6>
                                    <span class="badge bg-primary">In Progress</span>
                                </div>
                                <small class="text-muted">Robot R1 ‚Ä¢ Started 5 min ago</small>
                            </div>
                            <div class="list-group-item task-ready" data-id="T-102">
                                <div class="d-flex justify-content-between">
                                    <h6 class="mb-1">T-102: Collect from Table 3</h6>
                                    <span class="badge bg-success">Pending</span>
                                </div>
                                <small class="text-muted">High Priority ‚Ä¢ Waiting for assignment</small>
                            </div>
                            <div class="list-group-item task-waiting" data-id="T-103">
                                <div class="d-flex justify-content-between">
                                    <h6 class="mb-1">T-103: Move to Kitchen</h6>
                                    <span class="badge bg-warning">Queued</span>
                                </div>
                                <small class="text-muted">Medium Priority ‚Ä¢ Release in 3 min</small>
                            </div>
                            <div class="list-group-item task-ready" data-id="T-104">
                                <div class="d-flex justify-content-between">
                                    <h6 class="mb-1">T-104: Payment at Table 2</h6>
                                    <span class="badge bg-success">Pending</span>
                                </div>
                                <small class="text-muted">Low Priority ‚Ä¢ Waiting for assignment</small>
                            </div>
                            <div class="list-group-item task-ready" data-id="T-105">
                                <div class="d-flex justify-content-between">
                                    <h6 class="mb-1">T-105: Charging Request</h6>
                                    <span class="badge bg-success">Pending</span>
                                </div>
                                <small class="text-muted">Dynamic Priority ‚Ä¢ Robot R2 (30% battery)</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Robot Status Panel -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-robot me-2"></i>Robot Status Panel</h5>
                    </div>
                    <div class="card-body">
                        <div class="list-group">
                            <div class="list-group-item robot-moving" data-robot-id="R1">
                                <div class="d-flex justify-content-between">
                                    <h6 class="mb-1">R1 - Moving</h6>
                                    <span class="badge bg-success robot-battery">85%</span>
                                </div>
                                <small class="text-muted robot-location">Delivering to Table 5</small>
                            </div>
                            <div class="list-group-item robot-charging" data-robot-id="R2">
                                <div class="d-flex justify-content-between">
                                    <h6 class="mb-1">R2 - Charging</h6>
                                    <span class="badge bg-warning robot-battery">30%</span>
                                </div>
                                <small class="text-muted robot-location">At Charging Station</small>
                            </div>
                            <div class="list-group-item robot-moving" data-robot-id="R3">
                                <div class="d-flex justify-content-between">
                                    <h6 class="mb-1">R3 - Moving</h6>
                                    <span class="badge bg-success robot-battery">67%</span>
                                </div>
                                <small class="text-muted robot-location">Collecting from Table 3</small>
                            </div>
                            <div class="list-group-item robot-idle" data-robot-id="R4">
                                <div class="d-flex justify-content-between">
                                    <h6 class="mb-1">R4 - Idle</h6>
                                    <span class="badge bg-success robot-battery">92%</span>
                                </div>
                                <small class="text-muted robot-location">At Base Station</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Summary -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="alert alert-info d-flex justify-content-between align-items-center">
                    <div>
                        <i class="bi bi-info-circle me-2"></i>
                        <strong>System Summary:</strong> Tasks(15) | Waiting(5) | Ready(7) | Running(3)
                    </div>
                    <div>
                        <button class="btn btn-sm btn-outline-primary me-2">
                            <i class="bi bi-arrow-repeat me-1"></i>Refresh
                        </button>
                        <button class="btn btn-sm btn-outline-secondary">
                            <i class="bi bi-gear me-1"></i>Settings
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="/static/js/router.js"></script>
    <script src="/static/js/navigation.js"></script>
    <script src="/static/js/websocket.js"></script>
    <script src="/static/js/api.js"></script>
    <script src="/static/js/app.js"></script>
    
    <script>
        // Initialize map
        const map = L.map('map').setView([51.5, -0.09], 13);
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);
        
        // Add markers for restaurant layout
        const kitchen = L.marker([51.5, -0.09]).addTo(map)
            .bindPopup('Kitchen')
            .openPopup();
            
        const chargingStation = L.marker([51.51, -0.1]).addTo(map)
            .bindPopup('Charging Station');
            
        // Add table markers
        const tables = [
            {pos: [51.49, -0.08], name: 'T1'},
            {pos: [51.495, -0.075], name: 'T2'},
            {pos: [51.505, -0.085], name: 'T3'},
            {pos: [51.51, -0.07], name: 'T4'},
            {pos: [51.495, -0.1], name: 'T5'}
        ];
        
        tables.forEach(table => {
            L.marker(table.pos).addTo(map)
                .bindPopup(table.name);
        });
        
        // Add robot marker
        const robot = L.marker([51.5, -0.09], {
            icon: L.divIcon({
                className: 'robot-marker',
                html: '<div style="background: blue; color: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;"><i class="bi bi-robot"></i></div>',
                iconSize: [30, 30]
            })
        }).addTo(map)
        .bindPopup('Robot R1 - Delivering to Table 5');
        
        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', function() {
            alert('Logged out successfully');
            // In a real app, you would redirect to login page
        });
        
        // Simulate real-time updates
        setInterval(() => {
            // Update robot position randomly for demo
            const newPos = [
                51.5 + (Math.random() - 0.5) * 0.01,
                -0.09 + (Math.random() - 0.5) * 0.01
            ];
            robot.setLatLng(newPos);
        }, 5000);
    </script>
</body>
</html>